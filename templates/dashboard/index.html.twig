<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Engine - Content Discovery Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 2rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 3rem;
            animation: fadeInDown 0.6s ease-out;
        }

        h1 {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            color: #a0a0a0;
            font-size: 1.1rem;
            font-weight: 300;
        }

        .search-section {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: fadeInUp 0.6s ease-out 0.2s backwards;
        }

        .search-form {
            display: grid;
            grid-template-columns: 1fr auto auto auto;
            gap: 1rem;
            align-items: center;
        }

        input[type="text"],
        select {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 0.9rem 1.2rem;
            color: #fff;
            font-size: 1rem;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
        }

        input[type="text"]:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
            background: rgba(255, 255, 255, 0.12);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        input[type="text"]::placeholder {
            color: #888;
        }

        select option {
            background: #1a1a2e;
            color: #fff;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 12px;
            padding: 0.9rem 2.5rem;
            color: #fff;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .results-section {
            animation: fadeInUp 0.6s ease-out 0.4s backwards;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .results-count {
            font-size: 1.2rem;
            color: #a0a0a0;
        }

        .results-count strong {
            color: #667eea;
            font-weight: 600;
        }

        .results-grid {
            display: grid;
            gap: 1rem;
        }

        .content-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            animation: fadeInUp 0.4s ease-out backwards;
        }

        .content-card:hover {
            transform: translateY(-4px);
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(102, 126, 234, 0.3);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #fff;
            flex: 1;
            margin-right: 1rem;
        }

        .score-badge {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: #fff;
            padding: 0.4rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.95rem;
            white-space: nowrap;
            box-shadow: 0 2px 10px rgba(245, 87, 108, 0.3);
        }

        .score-high {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            box-shadow: 0 2px 10px rgba(67, 233, 123, 0.3);
        }

        .card-meta {
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #999;
            font-size: 0.9rem;
        }

        .type-badge {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .type-video {
            background: rgba(255, 107, 107, 0.2);
            color: #ff6b6b;
            border: 1px solid rgba(255, 107, 107, 0.3);
        }

        .type-article {
            background: rgba(78, 205, 196, 0.2);
            color: #4ecdc4;
            border: 1px solid rgba(78, 205, 196, 0.3);
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        .pagination a,
        .pagination span {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 0.6rem 1rem;
            color: #e0e0e0;
            text-decoration: none;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .pagination a:hover {
            background: rgba(102, 126, 234, 0.2);
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .pagination .current {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: transparent;
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.3);
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: #888;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        .error-message {
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid rgba(255, 107, 107, 0.3);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            color: #ff6b6b;
            margin-bottom: 1.5rem;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            .search-form {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 2rem;
            }

            .card-header {
                flex-direction: column;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üîç Content Discovery</h1>
            <p class="subtitle">Unified search across multiple content providers</p>
        </header>

        <div class="search-section">
            <form id="searchForm" method="get" action="/" class="search-form">
                <input 
                    type="text" 
                    id="searchInput"
                    name="q" 
                    placeholder="Search for content..." 
                    value="{{ filters.keyword }}"
                >
                
                <select id="typeFilter" name="type">
                    <option value="">All Types</option>
                    <option value="video" {% if filters.type == 'video' %}selected{% endif %}>Video</option>
                    <option value="article" {% if filters.type == 'article' %}selected{% endif %}>Article</option>
                </select>
                
                <select id="sortFilter" name="sort">
                    <option value="score_desc" {% if filters.sort == 'score_desc' or filters.sort is not defined %}selected{% endif %}>‚≠ê Score (High ‚Üí Low)</option>
                    <option value="score_asc" {% if filters.sort == 'score_asc' %}selected{% endif %}>‚≠ê Score (Low ‚Üí High)</option>
                    <option value="date_desc" {% if filters.sort == 'date_desc' %}selected{% endif %}>üìÖ Date (New ‚Üí Old)</option>
                    <option value="date_asc" {% if filters.sort == 'date_asc' %}selected{% endif %}>üìÖ Date (Old ‚Üí New)</option>
                </select>
                
                <button type="submit">Search</button>
            </form>
            
            <div id="loadingIndicator" style="display: none; text-align: center; margin-top: 1rem; color: #667eea;">
                <div style="animation: pulse 1.5s ease-in-out infinite;">‚è≥ Searching...</div>
            </div>
        </div>

        <div class="results-section">
            <div id="resultsContainer">
            {% if error %}
                <div class="error-message">
                    ‚ö†Ô∏è Error: {{ error }}
                </div>
            {% endif %}

            {% if results is not empty %}
                <div class="results-header">
                    <div class="results-count">
                        Found <strong>{{ meta.total }}</strong> results
                    </div>
                </div>

                <div class="results-grid">
                    {% for content in results %}
                        <div class="content-card" style="animation-delay: {{ loop.index0 * 0.05 }}s">
                            <div class="card-header">
                                <h3 class="card-title">{{ content.title }}</h3>
                                <div class="score-badge {% if content.score >= 20 %}score-high{% endif %}">
                                    ‚≠ê {{ content.score|number_format(1) }}
                                </div>
                            </div>
                            
                            <div class="card-meta">
                                <div class="meta-item">
                                    <span class="type-badge type-{{ content.type }}">
                                        {% if content.type == 'video' %}üé•{% else %}üìÑ{% endif %} {{ content.type }}
                                    </span>
                                </div>
                                
                                <div class="meta-item">
                                    üìÖ {{ content.published_at }}
                                </div>

                                {% if content.metrics.views is defined %}
                                    <div class="meta-item">
                                        üëÅÔ∏è {{ content.metrics.views|number_format }}
                                    </div>
                                    <div class="meta-item">
                                        üëç {{ content.metrics.likes|number_format }}
                                    </div>
                                {% endif %}

                                {% if content.metrics.reading_time is defined %}
                                    <div class="meta-item">
                                        ‚è±Ô∏è {{ content.metrics.reading_time }} min
                                    </div>
                                    <div class="meta-item">
                                        ‚ù§Ô∏è {{ content.metrics.reactions|number_format }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                </div>

                {% if meta.total_pages > 1 %}
                    <div class="pagination">
                        {% if meta.page > 1 %}
                            <a href="?q={{ filters.keyword }}&type={{ filters.type }}&page={{ meta.page - 1 }}">‚Üê Previous</a>
                        {% endif %}

                        {% for page in 1..meta.total_pages %}
                            {% if page == meta.page %}
                                <span class="current">{{ page }}</span>
                            {% else %}
                                <a href="?q={{ filters.keyword }}&type={{ filters.type }}&page={{ page }}">{{ page }}</a>
                            {% endif %}
                        {% endfor %}

                        {% if meta.page < meta.total_pages %}
                            <a href="?q={{ filters.keyword }}&type={{ filters.type }}&page={{ meta.page + 1 }}">Next ‚Üí</a>
                        {% endif %}
                    </div>
                {% endif %}
            {% else %}
                <div class="empty-state">
                    <div class="empty-state-icon">üîç</div>
                    <h2>No results found</h2>
                    <p>Try a different search query or remove filters</p>
                </div>
            {% endif %}
            </div>
        </div>
    </div>

    <script>
        const searchForm = document.getElementById('searchForm');
        const searchInput = document.getElementById('searchInput');
        const typeFilter = document.getElementById('typeFilter');
        const sortFilter = document.getElementById('sortFilter');
        const resultsContainer = document.getElementById('resultsContainer');
        const loadingIndicator = document.getElementById('loadingIndicator');

        // AJAX search functionality
        searchForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const keyword = searchInput.value.trim();
            const type = typeFilter.value;
            const sort = sortFilter.value;
            
            // Build URL with query parameters
            const params = new URLSearchParams();
            if (keyword) params.append('q', keyword);
            if (type) params.append('type', type);
            if (sort) params.append('sort', sort);
            
            // Show loading indicator
            loadingIndicator.style.display = 'block';
            
            try {
                // Fetch from API
                const response = await fetch(`/api/search?${params.toString()}&limit=20`);
                
                if (!response.ok) {
                    throw new Error('Search failed');
                }
                
                const data = await response.json();
                
                // Update URL without page reload
                const newUrl = `/?${params.toString()}`;
                window.history.pushState({}, '', newUrl);
                
                // Sort results client-side
                const sortedData = sortResults(data, sort);
                
                // Render results
                renderResults(sortedData, keyword, type);
                
            } catch (error) {
                resultsContainer.innerHTML = `
                    <div class="error-message">
                        ‚ö†Ô∏è Error: ${error.message}
                    </div>
                `;
            } finally {
                loadingIndicator.style.display = 'none';
            }
        });

        function sortResults(data, sortBy) {
            const results = [...data.data]; // Create a copy
            
            switch(sortBy) {
                case 'score_desc':
                    results.sort((a, b) => (b.score || 0) - (a.score || 0));
                    break;
                case 'score_asc':
                    results.sort((a, b) => (a.score || 0) - (b.score || 0));
                    break;
                case 'date_desc':
                    results.sort((a, b) => new Date(b.published_at) - new Date(a.published_at));
                    break;
                case 'date_asc':
                    results.sort((a, b) => new Date(a.published_at) - new Date(b.published_at));
                    break;
                default:
                    // Default: score descending
                    results.sort((a, b) => (b.score || 0) - (a.score || 0));
            }
            
            return { data: results, meta: data.meta };
        }

        function renderResults(data, keyword, type) {
            const { data: results, meta } = data;
            
            if (results.length === 0) {
                resultsContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üîç</div>
                        <h2>No results found</h2>
                        <p>Try a different search query or remove filters</p>
                    </div>
                `;
                return;
            }
            
            let html = `
                <div class="results-header">
                    <div class="results-count">
                        Found <strong>${meta.total}</strong> results
                    </div>
                </div>
                <div class="results-grid">
            `;
            
            results.forEach((content, index) => {
                const scoreClass = content.score >= 20 ? 'score-high' : '';
                const typeIcon = content.type === 'video' ? 'üé•' : 'üìÑ';
                
                html += `
                    <div class="content-card" style="animation-delay: ${index * 0.05}s">
                        <div class="card-header">
                            <h3 class="card-title">${escapeHtml(content.title)}</h3>
                            <div class="score-badge ${scoreClass}">
                                ‚≠ê ${content.score ? content.score.toFixed(1) : '0.0'}
                            </div>
                        </div>
                        <div class="card-meta">
                            <div class="meta-item">
                                <span class="type-badge type-${content.type}">
                                    ${typeIcon} ${content.type}
                                </span>
                            </div>
                            <div class="meta-item">
                                üìÖ ${content.published_at}
                            </div>
                `;
                
                if (content.metrics.views !== undefined) {
                    html += `
                            <div class="meta-item">
                                üëÅÔ∏è ${content.metrics.views.toLocaleString()}
                            </div>
                            <div class="meta-item">
                                üëç ${content.metrics.likes.toLocaleString()}
                            </div>
                    `;
                } else if (content.metrics.reading_time !== undefined) {
                    html += `
                            <div class="meta-item">
                                ‚è±Ô∏è ${content.metrics.reading_time} min
                            </div>
                            <div class="meta-item">
                                ‚ù§Ô∏è ${content.metrics.reactions.toLocaleString()}
                            </div>
                    `;
                }
                
                html += `
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            
            // Add pagination if needed
            if (meta.total_pages > 1) {
                html += '<div class="pagination">';
                
                if (meta.page > 1) {
                    html += `<a href="#" onclick="searchPage(${meta.page - 1}); return false;">‚Üê Previous</a>`;
                }
                
                for (let i = 1; i <= meta.total_pages; i++) {
                    if (i === meta.page) {
                        html += `<span class="current">${i}</span>`;
                    } else {
                        html += `<a href="#" onclick="searchPage(${i}); return false;">${i}</a>`;
                    }
                }
                
                if (meta.page < meta.total_pages) {
                    html += `<a href="#" onclick="searchPage(${meta.page + 1}); return false;">Next ‚Üí</a>`;
                }
                
                html += '</div>';
            }
            
            resultsContainer.innerHTML = html;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Handle browser back/forward
        window.addEventListener('popstate', () => {
            location.reload();
        });
        
        // Add pulse animation for loading
        const style = document.createElement('style');
        style.textContent = `
            @keyframes pulse {
                0%, 100% { opacity: 1; }
                50% { opacity: 0.5; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
